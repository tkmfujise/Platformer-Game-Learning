---
title: src/chapters/0/stages/0/stage_0.tscn
---
:toc:

== src / chapters / 0 / stages / 0 / stage_0.tscn

=== Diagram
[plantuml]
....
class R as "Stage0" <<(C,lightgreen) Control>> {
---
}
class N1 as "OpeningCurtain" <<(C,lightgreen) Control>> {
  * pattern
  * center
---
  + set_center()
  + play()
}
class N2 as "ColorRect" <<(C,lightgreen) ColorRect>> {
}
class N3 as "Forest" <<(N,lightskyblue) Node2D>> {
}
class N4 as "Frames" <<(N,lightskyblue) Node2D>> {
}
class N5 as "CameralFrame" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class N6 as "CameraFrame2" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class N7 as "CameraFrame3" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class N8 as "StageGround0" <<(T,yellow) TileMapLayer>> {
}
class N9 as "Gimmicks" <<(N,lightskyblue) Node2D>> {
}
class N10 as "FallingIceBlock" <<(R,lightskyblue) RigidBody2D>> {
---
  + _ready()
  + fall()
  + _on_detection_area_2d_body_entered()
}
class N11 as "Player" <<(C,lightskyblue) CharacterBody2D>> {
  ~ dashed
  ~ failed
---
  - SPEED
  - DASH_SPEED
  - JUMP_VELOCITY
  - GRAVITY
  - ALLOWED_TIME_TO_JUMP
  - DASH_TIME
  - DASH_ATTENUATION
  - MAX_DASH_COUNT
  * GhostEffect
  * falling_time
  * dash_rest_time
  * dash_rest_count
  * grounding
  * is_failed
---
  + _physics_process()
  + animate()
  + vibrate()
  + get_state()
  + update_sprite_states_shader_parameters()
  + spawn_ghost_effect()
  + current_sprite_state()
  + is_dashed()
  + _on_dashed()
  + _on_failed()
  + _on_frame_subject_area_entered()
  + _on_frame_subject_area_exited()
  + _on_failure_collision_area_entered()
}
class N12 as "Weather" <<(N,lightskyblue) Node2D>> {
---
  + _process()
  + current_camera()
}
class N13 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N3
R --o N4
R --o N8
R --o N9
R --o N11
R --o N12
R --o N13
N4 --o N5
N4 --o N6
N4 --o N7
N9 --o N10
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction

....




=== Overridden virtual functions
==== _ready
.$Gimmicks/FallingIceBlock
```gdscript
func _ready() -> void:
	freeze = true
```
==== _physics_process
.$Player
```gdscript
func _physics_process(delta: float) -> void:
	if is_failed:
		return
	if dash_rest_time > 0:
		dash_rest_time -= delta
		velocity *= DASH_ATTENUATION * delta
	else:
		# Add the gravity.
		if not is_on_floor():
			velocity.y += GRAVITY * delta
			falling_time += delta
			grounding = false
		else:
			if not grounding: vibrate('Landed')
			grounding = true
			falling_time = 0
			dash_rest_count = MAX_DASH_COUNT

		# Handle jump.
		if Input.is_action_just_pressed("move_jump") and falling_time < ALLOWED_TIME_TO_JUMP:
			velocity.y = JUMP_VELOCITY

		var direction_x := Input.get_axis("move_left", "move_right")
		if direction_x:
			velocity.x = direction_x * SPEED
		else:
			velocity.x = move_toward(velocity.x, 0, SPEED)

		# Handle dash.
		if Input.is_action_just_pressed("move_dash") && dash_rest_count > 0:
			var direction_y := Input.get_axis("move_up", "move_down")
			var direction = Vector2(direction_x, direction_y).normalized()
			if direction:
				dashed.emit()
				velocity = direction * DASH_SPEED
				dash_rest_time = DASH_TIME
				dash_rest_count -= 1
	animate()
	move_and_slide()
```
==== _process
.$Weather
```gdscript
func _process(_delta: float) -> void:
	var camera = current_camera()
	if camera: global_position = camera.global_position
```


=== Instantiators
CAUTION: No other scene instantiate this scene.

=== Scene Tree
[.scene-tree]
* [.node-name.type-control]#Stage0# [.node-type.type-control]#Control#
** [.node-name.type-control]#OpeningCurtain# [.node-type.type-control]#link:/scenes/src/curtain/opening/opening.tscn[res://src/curtain/opening/opening.tscn]#
** [.node-name.type-control]#ColorRect# [.node-type.type-control]#ColorRect#
** [.node-name.type-2d]#Forest# [.node-type.type-2d]#link:/scenes/src/stages/background/forest/forest.tscn[res://src/stages/background/forest/forest.tscn]#
** [.node-name.type-2d]#Frames# [.node-type.type-2d]#Node2D#
*** [.node-name.type-2d]#CameralFrame# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
*** [.node-name.type-2d]#CameraFrame2# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
*** [.node-name.type-2d]#CameraFrame3# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
** [.node-name.type-other]#StageGround0# [.node-type.type-other]#link:/scenes/src/stages/0/staege_ground_0.tscn[res://src/stages/0/staege_ground_0.tscn]#
** [.node-name.type-2d]#Gimmicks# [.node-type.type-2d]#Node2D#
*** [.node-name.type-2d]#FallingIceBlock# [.node-type.type-2d]#link:/scenes/src/stages/gimmicks/falling_ice_block/falling_ice_block.tscn[res://src/stages/gimmicks/falling_ice_block/falling_ice_block.tscn]#
** [.node-name.type-2d]#Player# [.node-type.type-2d]#link:/scenes/src/player/player.tscn[res://src/player/player.tscn]#
** [.node-name.type-2d]#Weather# [.node-type.type-2d]#link:/scenes/src/stages/weather/weather.tscn[res://src/stages/weather/weather.tscn]#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
NOTE: No signal connections.

=== Animations
==== opening (autoplay)

[plantuml]
....
control "Root" as R
participant "$OpeningCurtain" as T0



== Time: 0.0 ==
R  ->o  T0 : &"play"()


....
---



=== Properties
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`3`
|*anchors_preset* |`15`
|*anchor_right* |`1.0`
|*anchor_bottom* |`1.0`
|*grow_horizontal* |`2`
|*grow_vertical* |`2`
|*script* |`ExtResource("1_cvjvb")`
|===
.#$OpeningCurtain# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`1`
|*pattern* |`1`
|*center* |`Vector2(0.3, 0.6)`
|===
.#$ColorRect# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`1`
|*anchors_preset* |`15`
|*anchor_right* |`1.0`
|*anchor_bottom* |`1.0`
|*offset_top* |`-2073.0`
|*offset_right* |`5082.0`
|*grow_horizontal* |`2`
|*grow_vertical* |`2`
|*color* |`Color(0.066755, 0.066755, 0.066755, 1)`
|===
.#$Frames/CameralFrame# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* |`Vector2(960, 540)`
|===
.#$Frames/CameraFrame2# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* |`Vector2(1895, 540)`
|===
.#$Frames/CameraFrame3# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* |`Vector2(3824, 547)`
|===
.#$StageGround0# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*tile_map_data* |`PackedByteArray("AAAKAAkAAAACAAAAAAAJAAoAAAAEAAEAAAAJAAsAAAAEAAEAAAAJAAkAAAABAAAAAAAIAAkAAAADAAAAAAAAAAoAAAAEAAAAAAABAAoAAAAEAAAAAAACAAoAAAAEAAAAAAADAAoAAAAEAAAAAAAEAAoAAAAEAAAAAAAFAAoAAAAEAAAAAAAGAAoAAAAEAAAAAAAHAAoAAAABAAAAAAAIAAoAAAABAAAAAAAIAAsAAAAEAAEAAAAHAAsAAAAEAAEAAAAGAAsAAAAEAAEAAAAFAAsAAAAEAAEAAAAEAAsAAAAEAAEAAAADAAsAAAAEAAEAAAACAAsAAAAEAAEAAAABAAsAAAAEAAEAAAAAAAsAAAAEAAEAAAAOAAsAAAADAAAAAAASAAsAAAAFAAAAAAARAAkAAAAFAAAAAAAQAAoAAAADAAEAAAAQAAkAAAADAAAAAAAPAAsAAAAEAAAAAAAQAAsAAAAEAAAAAAARAAsAAAAEAAEAAAARAAoAAAAFAAEAAAAOAAwAAAADAAEAAAAOAA0AAAADAAEAAAAPAAwAAAAEAAEAAAAPAA0AAAAEAAEAAAAQAAwAAAAEAAEAAAAQAA0AAAAEAAEAAAARAAwAAAAEAAEAAAARAA0AAAAEAAEAAAASAAwAAAAFAAEAAAASAA0AAAAFAAEAAAAAAAwAAAAEAAEAAAABAAwAAAAEAAEAAAACAAwAAAAEAAEAAAADAAwAAAAEAAEAAAAEAAwAAAAEAAEAAAAFAAwAAAAEAAEAAAAGAAwAAAAEAAEAAAAHAAwAAAAEAAEAAAAIAAwAAAAEAAEAAAAJAAwAAAACAAEAAAAKAAoAAAACAAEAAAAAAA0AAAAEAAEAAAABAA0AAAAEAAEAAAACAA0AAAAEAAEAAAADAA0AAAAEAAEAAAAEAA0AAAAEAAEAAAAFAA0AAAAEAAEAAAAGAA0AAAAEAAEAAAAHAA0AAAAEAAEAAAAIAA0AAAAEAAEAAAAJAA0AAAACAAEAAAAKAAsAAAACAAIAAAASAP7/AAAEAAAAAAASAP//AAAEAAEAAAASAAAAAAAEAAEAAAASAAEAAAAFAAIAAAATAP7/AAAEAAAAAAATAP//AAAEAAEAAAAUAP7/AAAEAAAAAAAUAP//AAAEAAEAAAAUAAAAAAAEAAIAAAAVAP7/AAAEAAAAAAAVAP//AAAEAAEAAAAVAAAAAAAEAAEAAAAWAP7/AAAEAAAAAAAWAP//AAAEAAEAAAAWAAAAAAAEAAEAAAAXAP7/AAAEAAAAAAAXAP//AAAEAAEAAAAXAAAAAAAEAAEAAAAYAP7/AAAEAAAAAAAYAP//AAAEAAEAAAAYAAAAAAAEAAEAAAAZAP7/AAAFAAAAAAAZAP//AAAEAAEAAAAZAAAAAAAEAAEAAAARAP7/AAADAAAAAAARAP//AAADAAEAAAARAAAAAAADAAEAAAARAAEAAAADAAIAAAAWAAoAAAAEAAAAAAAWAAsAAAAEAAEAAAAXAAoAAAAEAAAAAAAXAAsAAAAEAAEAAAAXAAwAAAAEAAEAAAAXAA0AAAAEAAEAAAAYAAoAAAAEAAAAAAAYAAsAAAAEAAEAAAAYAAwAAAAFAAEAAAAYAA0AAAAFAAEAAAAZAAoAAAAFAAAAAAAZAAsAAAAFAAIAAAAVAAoAAAADAAAAAAAVAAsAAAADAAIAAAAWAAwAAAADAAEAAAAWAA0AAAADAAEAAAANAAMAAAADAAAAAAANAAQAAAADAAIAAAAOAAMAAAAFAAAAAAAOAAQAAAAFAAIAAAAUAAEAAAAAAAIAAAAVAAEAAAABAAEAAAAVAAIAAAAAAAIAAAAWAAEAAAABAAEAAAAWAAIAAAABAAIAAAAXAAEAAAABAAEAAAAXAAIAAAABAAIAAAAYAAEAAAAEAAEAAAAYAAIAAAABAAIAAAAZAAEAAAAFAAEAAAAZAAIAAAACAAIAAAATAAAAAAAEAAIAAAAaAAAAAAAFAAIAAAAaAP//AAAEAAEAAAAbAP//AAAFAAIAAAAbAP7/AAAFAAAAAAAaAP7/AAAEAAAAAAAdAAwAAAADAAAAAAAdAA0AAAADAAIAAAAeAAwAAAABAAAAAAAeAA0AAAAEAAEAAAAfAAoAAAADAAAAAAAfAAsAAAADAAEAAAAfAAwAAAADAAEAAAAfAA0AAAAEAAEAAAAgAAoAAAAFAAAAAAAgAAsAAAAFAAEAAAAgAAwAAAAFAAEAAAAgAA0AAAAFAAIAAAAjAAwAAAAEAAAAAAAjAA0AAAAEAAEAAAAkAAwAAAAEAAAAAAAkAA0AAAAEAAEAAAAlAAwAAAAEAAAAAAAmAAwAAAAEAAAAAAAnAAwAAAAEAAAAAAAoAAwAAAAEAAAAAAAiAAwAAAADAAAAAAAiAA0AAAADAAIAAAA=")`
|===
.#$Gimmicks/FallingIceBlock# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* |`Vector2(1882, 332)`
|===
.#$Player# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* |`Vector2(328, 284)`
|===
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*libraries* |`{
&"": SubResource("AnimationLibrary_arpf2")
}`
|*autoplay* |`opening`
|===


=== link:/scripts/src/chapters/0/stages/0/stage_0.gd[stage_0.gd]

```gdscript
extends Control

```


