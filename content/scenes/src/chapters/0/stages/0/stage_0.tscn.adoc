---
title: src/chapters/0/stages/0/stage_0.tscn
---
:toc:

== src / chapters / 0 / stages / 0 / stage_0.tscn

=== Diagram
[plantuml]
....
class ROOT as "Stage0" <<(C,lightgreen) Control>> {
---
}
class OpeningCurtain as "OpeningCurtain" <<(C,lightgreen) Control>> {
  * pattern
  * center
---
  + set_center()
  + play()
}
class ColorRect as "ColorRect" <<(C,lightgreen) ColorRect>> {
}
class Forest as "Forest" <<(N,lightskyblue) Node2D>> {
}
class Frames as "Frames" <<(N,lightskyblue) Node2D>> {
}
class Frames_CameralFrame as "CameralFrame" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class Frames_CameraFrame2 as "CameraFrame2" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class Frames_CameraFrame3 as "CameraFrame3" <<(A,lightskyblue) Area2D>> {
  - HALF_SIZE
---
  + corner()
}
class StageGround0 as "StageGround0" <<(T,darkgray) TileMapLayer>> {
}
class Gimmicks as "Gimmicks" <<(N,lightskyblue) Node2D>> {
}
class Gimmicks_FallingIceBlock as "FallingIceBlock" <<(R,lightskyblue) RigidBody2D>> {
---
  + _ready()
  + fall()
  + _on_detection_area_2d_body_entered()
}
class Player as "Player" <<(C,lightskyblue) CharacterBody2D>> {
  ~ dashed
  ~ failed
---
  - SPEED
  - DASH_SPEED
  - JUMP_VELOCITY
  - GRAVITY
  - ALLOWED_TIME_TO_JUMP
  - DASH_TIME
  - DASH_ATTENUATION
  - MAX_DASH_COUNT
  * GhostEffect
  * falling_time
  * dash_rest_time
  * dash_rest_count
  * grounding
  * is_failed
---
  + _physics_process()
  + animate()
  + vibrate()
  + get_state()
  + update_sprite_states_shader_parameters()
  + spawn_ghost_effect()
  + current_sprite_state()
  + is_dashed()
  + _on_dashed()
  + _on_failed()
  + _on_frame_subject_area_entered()
  + _on_frame_subject_area_exited()
  + _on_failure_collision_area_entered()
}
class Weather as "Weather" <<(N,lightskyblue) Node2D>> {
---
  + _process()
  + current_camera()
}
class AnimationPlayer as "AnimationPlayer" <<(A,darkgray) AnimationPlayer>> {
}
ROOT --o OpeningCurtain
ROOT --o ColorRect
ROOT --o Forest
ROOT --o Frames
ROOT --o StageGround0
ROOT --o Gimmicks
ROOT --o Player
ROOT --o Weather
ROOT --o AnimationPlayer
Frames --o Frames_CameralFrame
Frames --o Frames_CameraFrame2
Frames --o Frames_CameraFrame3
Gimmicks --o Gimmicks_FallingIceBlock
left to right direction

....


=== Overridden virtual functions
==== _ready
.$Gimmicks/FallingIceBlock
```gdscript
func _ready() -> void:
	freeze = true
```
==== _physics_process
.$Player
```gdscript
func _physics_process(delta: float) -> void:
	if is_failed:
		return
	if dash_rest_time > 0:
		dash_rest_time -= delta
		velocity *= DASH_ATTENUATION * delta
	else:
		# Add the gravity.
		if not is_on_floor():
			velocity.y += GRAVITY * delta
			falling_time += delta
			grounding = false
		else:
			if not grounding: vibrate('Landed')
			grounding = true
			falling_time = 0
			dash_rest_count = MAX_DASH_COUNT

		# Handle jump.
		if Input.is_action_just_pressed("move_jump") and falling_time < ALLOWED_TIME_TO_JUMP:
			velocity.y = JUMP_VELOCITY

		var direction_x := Input.get_axis("move_left", "move_right")
		if direction_x:
			velocity.x = direction_x * SPEED
		else:
			velocity.x = move_toward(velocity.x, 0, SPEED)

		# Handle dash.
		if Input.is_action_just_pressed("move_dash") && dash_rest_count > 0:
			var direction_y := Input.get_axis("move_up", "move_down")
			var direction = Vector2(direction_x, direction_y).normalized()
			if direction:
				dashed.emit()
				velocity = direction * DASH_SPEED
				dash_rest_time = DASH_TIME
				dash_rest_count -= 1
	animate()
	move_and_slide()
```
==== _process
.$Weather
```gdscript
func _process(_delta: float) -> void:
	var camera = current_camera()
	if camera: global_position = camera.global_position
```



=== Instantiators
CAUTION: No other scene instantiate this scene.

=== Scene Tree
[.scene-tree]
* [.node-name.type-control]#Stage0# [.node-type.type-control]#Control#
** [.node-name.type-control]#OpeningCurtain# [.node-type.type-control]#link:/scenes/src/curtain/opening/opening.tscn[res://src/curtain/opening/opening.tscn]#
** [.node-name.type-control]#ColorRect# [.node-type.type-control]#ColorRect#
** [.node-name.type-2d]#Forest# [.node-type.type-2d]#link:/scenes/src/stages/background/forest/forest.tscn[res://src/stages/background/forest/forest.tscn]#
** [.node-name.type-2d]#Frames# [.node-type.type-2d]#Node2D#
*** [.node-name.type-2d]#CameralFrame# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
*** [.node-name.type-2d]#CameraFrame2# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
*** [.node-name.type-2d]#CameraFrame3# [.node-type.type-2d]#link:/scenes/src/stages/frame/camera_frame.tscn[res://src/stages/frame/camera_frame.tscn]#
** [.node-name.type-other]#StageGround0# [.node-type.type-other]#link:/scenes/src/stages/0/staege_ground_0.tscn[res://src/stages/0/staege_ground_0.tscn]#
** [.node-name.type-2d]#Gimmicks# [.node-type.type-2d]#Node2D#
*** [.node-name.type-2d]#FallingIceBlock# [.node-type.type-2d]#link:/scenes/src/stages/gimmicks/falling_ice_block/falling_ice_block.tscn[res://src/stages/gimmicks/falling_ice_block/falling_ice_block.tscn]#
** [.node-name.type-2d]#Player# [.node-type.type-2d]#link:/scenes/src/player/player.tscn[res://src/player/player.tscn]#
** [.node-name.type-2d]#Weather# [.node-type.type-2d]#link:/scenes/src/stages/weather/weather.tscn[res://src/stages/weather/weather.tscn]#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Animations
==== opening

[plantuml]
....
control "Root" as Root
participant "OpeningCurtain" as T0



== Time: 0.0 ==
Root  ->o  T0 : &"play"()


....
---



=== Signal Connections
NOTE: No signal connections.

=== Properties
[cols="1,1,3" options="header"]
|===
|Section |Name |Value
|_sub_resource_ |*resource_name* |`opening`
|_sub_resource_ |*tracks/0/type* |`method`
|_sub_resource_ |*tracks/0/imported* |`false`
|_sub_resource_ |*tracks/0/enabled* |`true`
|_sub_resource_ |*tracks/0/path* |`NodePath("OpeningCurtain")`
|_sub_resource_ |*tracks/0/interp* |`1`
|_sub_resource_ |*tracks/0/loop_wrap* |`true`
|_sub_resource_ |*tracks/0/keys* |`{
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"play"
}]
}`
|_sub_resource_ |*_data* |`{
&"opening": SubResource("Animation_8qtw2")
}`
|_node_ |*layout_mode* |`3`
|_node_ |*anchors_preset* |`15`
|_node_ |*anchor_right* |`1.0`
|_node_ |*anchor_bottom* |`1.0`
|_node_ |*grow_horizontal* |`2`
|_node_ |*grow_vertical* |`2`
|_node_ |*script* |`ExtResource("1_cvjvb")`
|_node_ |*layout_mode* |`1`
|_node_ |*pattern* |`1`
|_node_ |*center* |`Vector2(0.3, 0.6)`
|_node_ |*layout_mode* |`1`
|_node_ |*anchors_preset* |`15`
|_node_ |*anchor_right* |`1.0`
|_node_ |*anchor_bottom* |`1.0`
|_node_ |*offset_top* |`-2073.0`
|_node_ |*offset_right* |`5082.0`
|_node_ |*grow_horizontal* |`2`
|_node_ |*grow_vertical* |`2`
|_node_ |*color* |`Color(0.066755, 0.066755, 0.066755, 1)`
|_node_ |*position* |`Vector2(960, 540)`
|_node_ |*position* |`Vector2(1895, 540)`
|_node_ |*position* |`Vector2(3824, 547)`
|_node_ |*tile_map_data* |`PackedByteArray("AAAKAAkAAAACAAAAAAAJAAoAAAAEAAEAAAAJAAsAAAAEAAEAAAAJAAkAAAABAAAAAAAIAAkAAAADAAAAAAAAAAoAAAAEAAAAAAABAAoAAAAEAAAAAAACAAoAAAAEAAAAAAADAAoAAAAEAAAAAAAEAAoAAAAEAAAAAAAFAAoAAAAEAAAAAAAGAAoAAAAEAAAAAAAHAAoAAAABAAAAAAAIAAoAAAABAAAAAAAIAAsAAAAEAAEAAAAHAAsAAAAEAAEAAAAGAAsAAAAEAAEAAAAFAAsAAAAEAAEAAAAEAAsAAAAEAAEAAAADAAsAAAAEAAEAAAACAAsAAAAEAAEAAAABAAsAAAAEAAEAAAAAAAsAAAAEAAEAAAAOAAsAAAADAAAAAAASAAsAAAAFAAAAAAARAAkAAAAFAAAAAAAQAAoAAAADAAEAAAAQAAkAAAADAAAAAAAPAAsAAAAEAAAAAAAQAAsAAAAEAAAAAAARAAsAAAAEAAEAAAARAAoAAAAFAAEAAAAOAAwAAAADAAEAAAAOAA0AAAADAAEAAAAPAAwAAAAEAAEAAAAPAA0AAAAEAAEAAAAQAAwAAAAEAAEAAAAQAA0AAAAEAAEAAAARAAwAAAAEAAEAAAARAA0AAAAEAAEAAAASAAwAAAAFAAEAAAASAA0AAAAFAAEAAAAAAAwAAAAEAAEAAAABAAwAAAAEAAEAAAACAAwAAAAEAAEAAAADAAwAAAAEAAEAAAAEAAwAAAAEAAEAAAAFAAwAAAAEAAEAAAAGAAwAAAAEAAEAAAAHAAwAAAAEAAEAAAAIAAwAAAAEAAEAAAAJAAwAAAACAAEAAAAKAAoAAAACAAEAAAAAAA0AAAAEAAEAAAABAA0AAAAEAAEAAAACAA0AAAAEAAEAAAADAA0AAAAEAAEAAAAEAA0AAAAEAAEAAAAFAA0AAAAEAAEAAAAGAA0AAAAEAAEAAAAHAA0AAAAEAAEAAAAIAA0AAAAEAAEAAAAJAA0AAAACAAEAAAAKAAsAAAACAAIAAAASAP7/AAAEAAAAAAASAP//AAAEAAEAAAASAAAAAAAEAAEAAAASAAEAAAAFAAIAAAATAP7/AAAEAAAAAAATAP//AAAEAAEAAAAUAP7/AAAEAAAAAAAUAP//AAAEAAEAAAAUAAAAAAAEAAIAAAAVAP7/AAAEAAAAAAAVAP//AAAEAAEAAAAVAAAAAAAEAAEAAAAWAP7/AAAEAAAAAAAWAP//AAAEAAEAAAAWAAAAAAAEAAEAAAAXAP7/AAAEAAAAAAAXAP//AAAEAAEAAAAXAAAAAAAEAAEAAAAYAP7/AAAEAAAAAAAYAP//AAAEAAEAAAAYAAAAAAAEAAEAAAAZAP7/AAAFAAAAAAAZAP//AAAEAAEAAAAZAAAAAAAEAAEAAAARAP7/AAADAAAAAAARAP//AAADAAEAAAARAAAAAAADAAEAAAARAAEAAAADAAIAAAAWAAoAAAAEAAAAAAAWAAsAAAAEAAEAAAAXAAoAAAAEAAAAAAAXAAsAAAAEAAEAAAAXAAwAAAAEAAEAAAAXAA0AAAAEAAEAAAAYAAoAAAAEAAAAAAAYAAsAAAAEAAEAAAAYAAwAAAAFAAEAAAAYAA0AAAAFAAEAAAAZAAoAAAAFAAAAAAAZAAsAAAAFAAIAAAAVAAoAAAADAAAAAAAVAAsAAAADAAIAAAAWAAwAAAADAAEAAAAWAA0AAAADAAEAAAANAAMAAAADAAAAAAANAAQAAAADAAIAAAAOAAMAAAAFAAAAAAAOAAQAAAAFAAIAAAAUAAEAAAAAAAIAAAAVAAEAAAABAAEAAAAVAAIAAAAAAAIAAAAWAAEAAAABAAEAAAAWAAIAAAABAAIAAAAXAAEAAAABAAEAAAAXAAIAAAABAAIAAAAYAAEAAAAEAAEAAAAYAAIAAAABAAIAAAAZAAEAAAAFAAEAAAAZAAIAAAACAAIAAAATAAAAAAAEAAIAAAAaAAAAAAAFAAIAAAAaAP//AAAEAAEAAAAbAP//AAAFAAIAAAAbAP7/AAAFAAAAAAAaAP7/AAAEAAAAAAAdAAwAAAADAAAAAAAdAA0AAAADAAIAAAAeAAwAAAABAAAAAAAeAA0AAAAEAAEAAAAfAAoAAAADAAAAAAAfAAsAAAADAAEAAAAfAAwAAAADAAEAAAAfAA0AAAAEAAEAAAAgAAoAAAAFAAAAAAAgAAsAAAAFAAEAAAAgAAwAAAAFAAEAAAAgAA0AAAAFAAIAAAAjAAwAAAAEAAAAAAAjAA0AAAAEAAEAAAAkAAwAAAAEAAAAAAAkAA0AAAAEAAEAAAAlAAwAAAAEAAAAAAAmAAwAAAAEAAAAAAAnAAwAAAAEAAAAAAAoAAwAAAAEAAAAAAAiAAwAAAADAAAAAAAiAA0AAAADAAIAAAA=")`
|_node_ |*position* |`Vector2(1882, 332)`
|_node_ |*position* |`Vector2(328, 284)`
|_node_ |*unique_name_in_owner* |`true`
|_node_ |*libraries* |`{
&"": SubResource("AnimationLibrary_arpf2")
}`
|_node_ |*autoplay* |`opening`
|===


=== link:/scripts/src/chapters/0/stages/0/stage_0.gd[stage_0.gd]

```gdscript
extends Control

```


