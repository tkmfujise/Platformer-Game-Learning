---
title: src/dialogue/chapters/0/stage0.tscn
---
:toc:

== src / dialogue / chapters / 0 / stage0.tscn

=== Diagram
[plantuml]
....
class R as "Stage0" <<(N,lightskyblue) Node2D>> {
  ~ event
---
  * started
---
  + _ready()
  + start()
  + _on_event_area_2d_area_entered()
  + _on_dialogue_event()
}
class N1 as "Dialogue" <<(C,yellow) CanvasLayer>> {
  ~ finished
  ~ event
---
  * controller
  * speakers
  * current_speaker
  * started
---
  + _ready()
  + start()
  + continue_dialogue()
  + says()
  + set_speaker_image()
  + _input()
  + _handle()
  + _on_event()
  + _on_finished()
}
class N2 as "House" <<(S,lightskyblue) Sprite2D>> {
}
class N3 as "OldWoman" <<(S,lightskyblue) Sprite2D>> {
}
class N4 as "EventArea2D" <<(A,lightskyblue) Area2D>> {
}
class N5 as "CollisionShape2D" <<(C,lightskyblue) CollisionShape2D>> {
}
class N6 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N3
R --o N4
R --o N6
N4 --o N5
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction
_(R::_on_dialogue_event, N1::event)
_(R::_on_event_area_2d_area_entered, N4::area_entered)
....


[.scene-assets]
=== Assets
[.asset-image]
[link=/assets/assets/images/faces/Player_face.png]
image::/assets/raw/assets/images/faces/Player_face.png[200, 100] 

[.asset-image]
[link=/assets/assets/images/faces/actors/OldWoman_face.png]
image::/assets/raw/assets/images/faces/actors/OldWoman_face.png[200, 100] 

[.asset-image]
[link=/assets/assets/images/stages/chapter0/House.png]
image::/assets/raw/assets/images/stages/chapter0/House.png[200, 100] 



=== Overridden virtual functions
==== _ready
```gdscript
func _ready() -> void:
	if not owner: start()
```
.$Dialogue
```gdscript
func _ready() -> void:
	controller.channel.connect(_handle)
```
==== _input
.$Dialogue
```gdscript
func _input(event: InputEvent) -> void:
	if not started: return
	if event.is_action_pressed('ui_accept'):
		continue_dialogue()
```


=== Instantiators
* link:/scenes/src/chapters/0/stages/0/stage_0.tscn[res://src/chapters/0/stages/0/stage_0.tscn]


=== Scene Tree
[.scene-tree]
* [.node-name.type-2d]#Stage0# [.node-type.type-2d]#Node2D#
** [.node-name.type-other]#Dialogue# [.node-type.type-other]#link:/scenes/src/dialogue/dialogue.tscn[res://src/dialogue/dialogue.tscn]#
** [.node-name.type-2d]#House# [.node-type.type-2d]#Sprite2D#
** [.node-name.type-2d]#OldWoman# [.node-type.type-2d]#link:/scenes/src/actors/old_woman/old_woman.tscn[res://src/actors/old_woman/old_woman.tscn]#
** [.node-name.type-2d]#EventArea2D# [.node-type.type-2d]#Area2D#
*** [.node-name.type-2d]#CollisionShape2D# [.node-type.type-2d]#CollisionShape2D#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
[.signal-connection]
.$Dialogue:[#_event_#]=>$.
```gdscript
func _on_dialogue_event(event_name: String) -> void:
	var key = "event_%s" % event_name
	if %AnimationPlayer.has_animation(key):
		%AnimationPlayer.play(key)
	event.emit(event_name)
```
[.signal-connection]
.$EventArea2D:[#_area_entered_#]=>$.
```gdscript
func _on_event_area_2d_area_entered(area: Area2D) -> void:
	start()
```


=== Animations
==== Animation_oyqfx

[plantuml]
....
control "Root" as R
participant "$OldWoman" as T0 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : flip_h\n = true


....
---

==== event_02.pass_by

[plantuml]
....
control "Root" as R
participant "$OldWoman" as T0 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : flip_h\n = true
== Time: 0.5 ==
R  ->o  T0 : flip_h\n = false


....
---



=== Properties
[.node-property.node-2d]
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*script* a|link:/scripts/src/dialogue/chapters/0/stage_0.gd[res://src/dialogue/chapters/0/stage_0.gd]
|===
[.node-property.node-other]
.#$Dialogue# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*visible* a|`false`
|*controller* a|`SubResource("ReDScribe_2vwqn")`
|*speakers* a|`Array("[SubResource("Resource_ffs01"), SubResource("Resource_gkg18")]")`
|===
[.node-property.node-2d]
.#$House# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(920.00006, 671.00006)`
|*scale* a|`Vector2(10, 10)`
|*texture* a|[link=/assets/assets/images/stages/chapter0/House.png]
[.asset-image]
.res://assets/images/stages/chapter0/House.png
image::/assets/raw/assets/images/stages/chapter0/House.png[]

|===
[.node-property.node-2d]
.#$OldWoman# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(1042, 872)`
|===
[.node-property.node-2d]
.#$EventArea2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*collision_layer* a|`16`
|*collision_mask* a|`16`
|===
[.node-property.node-2d]
.#$EventArea2D/CollisionShape2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(498.25, 543)`
|*shape* a|`SubResource("RectangleShape2D_6qvxh")`
|===
[.node-property.node-other]
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*libraries* a|`{
&"": SubResource("AnimationLibrary_7eiyn")
}`
|===


=== link:/scripts/src/dialogue/chapters/0/stage_0.gd[stage_0.gd]

```gdscript
extends Node2D

signal event(event_name: String)

var started : bool = false


func _ready() -> void:
	if not owner: start()


func start() -> void:
	if started: return
	started = true
	%Dialogue.start()


func _on_event_area_2d_area_entered(area: Area2D) -> void:
	start()


func _on_dialogue_event(event_name: String) -> void:
	var key = "event_%s" % event_name
	if %AnimationPlayer.has_animation(key):
		%AnimationPlayer.play(key)
	event.emit(event_name)

```


