---
title: src/dialogue/chapters/0/stage0.tscn
---
:toc:

== src / dialogue / chapters / 0 / stage0.tscn

=== Diagram
[plantuml]
....
class R as "Stage0" <<(N,lightskyblue) Node2D>> {
  ~ event
---
  * started
---
  + _ready()
  + start()
  + _on_event_area_2d_area_entered()
  + _on_dialogue_event()
  + _on_dialogue_finished()
}
class N1 as "Dialogue" <<(C,yellow) CanvasLayer>> {
  ~ finished
  ~ paused
  ~ event
---
  * boot_file
  * speakers
  * started
  * controller
  * current_speaker
  * waiting
---
  + _ready()
  + start()
  + continue_dialogue()
  + stop()
  + says()
  + set_speaker_image()
  + _input()
  + _handle()
  + _on_event()
  + _on_event_timer_timeout()
  + _on_paused()
  + _on_finished()
}
class N2 as "House" <<(S,lightskyblue) Sprite2D>> {
}
class N3 as "OldWoman" <<(S,lightskyblue) Sprite2D>> {
}
class N4 as "LaughingParticles2D" <<(C,lightskyblue) CPUParticles2D>> {
}
class N5 as "EventArea2D" <<(A,lightskyblue) Area2D>> {
}
class N6 as "CollisionShape2D" <<(C,lightskyblue) CollisionShape2D>> {
}
class N7 as "Camera2D" <<(C,lightskyblue) Camera2D>> {
}
class N8 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N3
R --o N5
R --o N7
R --o N8
N3 --o N4
N5 --o N6
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction
_(R::_on_dialogue_event, N1::event)
_(R::_on_dialogue_finished, N1::finished)
_(R::_on_event_area_2d_area_entered, N5::area_entered)
....


[.scene-assets]
=== Assets
[.asset-image]
[link=/assets/assets/images/faces/Player_face.png]
image::/assets/raw/assets/images/faces/Player_face.png[200, 100] 

[.asset-image]
[link=/assets/assets/images/faces/actors/OldWoman_face.png]
image::/assets/raw/assets/images/faces/actors/OldWoman_face.png[200, 100] 

[.asset-image]
[link=/assets/assets/images/stages/chapter0/House.png]
image::/assets/raw/assets/images/stages/chapter0/House.png[200, 100] 

[.asset-image]
[link=/assets/assets/images/particles/HA.png]
image::/assets/raw/assets/images/particles/HA.png[200, 100] 



=== Overridden virtual functions
==== _ready
```gdscript
func _ready() -> void:
	if not owner: start()
```
.$Dialogue
```gdscript
func _ready() -> void:
	controller.boot_file = boot_file
	controller.channel.connect(_handle)
```
==== _input
.$Dialogue
```gdscript
func _input(_event: InputEvent) -> void:
	if not started: return
	if waiting: return
	if _event.is_action_pressed('ui_accept'):
		continue_dialogue()
```


=== Instantiators
* link:/scenes/src/chapters/0/stages/0/stage_0.tscn[res://src/chapters/0/stages/0/stage_0.tscn]


=== Scene Tree
[.scene-tree]
* [.node-name.type-2d]#Stage0# [.node-type.type-2d]#Node2D#
** [.node-name.type-other]#Dialogue# [.node-type.type-other]#link:/scenes/src/dialogue/dialogue.tscn[res://src/dialogue/dialogue.tscn]#
** [.node-name.type-2d]#House# [.node-type.type-2d]#Sprite2D#
** [.node-name.type-2d]#OldWoman# [.node-type.type-2d]#link:/scenes/src/actors/old_woman/old_woman.tscn[res://src/actors/old_woman/old_woman.tscn]#
*** [.node-name.type-2d]#LaughingParticles2D# [.node-type.type-2d]#CPUParticles2D#
** [.node-name.type-2d]#EventArea2D# [.node-type.type-2d]#Area2D#
*** [.node-name.type-2d]#CollisionShape2D# [.node-type.type-2d]#CollisionShape2D#
** [.node-name.type-2d]#Camera2D# [.node-type.type-2d]#Camera2D#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
[.signal-connection]
.$Dialogue:[#_event_#]=>$.
```gdscript
func _on_dialogue_event(event_name: String) -> void:
	var key = "event_%s" % event_name
	if %AnimationPlayer.has_animation(key):
		%AnimationPlayer.play(key)
	event.emit(event_name)
```
[.signal-connection]
.$Dialogue:[#_finished_#]=>$.
```gdscript
func _on_dialogue_finished() -> void:
	%AnimationPlayer.play('finished')
```
[.signal-connection]
.$EventArea2D:[#_area_entered_#]=>$.
```gdscript
func _on_event_area_2d_area_entered(_area: Area2D) -> void:
	start()
```


=== Animations
==== Animation_oyqfx

[plantuml]
....
control "Root" as R
participant "$OldWoman" as T0 #87CEFA
participant "$Camera2D" as T1 #87CEFA
participant "$OldWoman\n/LaughingParticles2D" as T3 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : flip_h\n = true
R  ->  T1 : zoom\n = Vector2(1, 1)
R  ->o  T1 : enabled\n = false
R  ->o  T3 : visible\n = false


....
---

==== event_02.pass_by

[plantuml]
....
control "Root" as R
participant "$OldWoman" as T0 #87CEFA
participant "$Camera2D" as T1 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : flip_h\n = true
R  ->  T1 : zoom\n = Vector2(1, 1)
== Time: 0.5 ==
R  ->o  T0 : flip_h\n = false
== Time: 1.7666667 ==
R  ->  T1 : zoom\n = Vector2(1.5, 1.5)


....
---

==== event_03.laughing

[plantuml]
....
control "Root" as R
participant "$OldWoman\n/LaughingParticles2D" as T0 #87CEFA



== Time: 1.0 ==
R  ->o  T0 : visible\n = true


....
---

==== event_04.zoom_in

[plantuml]
....
control "Root" as R
participant "$Camera2D" as T0 #87CEFA
participant "$OldWoman\n/LaughingParticles2D" as T1 #87CEFA



== Time: 0.0 ==
R  ->  T0 : zoom\n = Vector2(1.5, 1.5)
R  ->o  T1 : visible\n = false
== Time: 0.96666664 ==
R  ->  T0 : zoom\n = Vector2(2, 2)


....
---

==== event_05.zoom_out

[plantuml]
....
control "Root" as R





....
---

==== finished

[plantuml]
....
control "Root" as R
participant "$Camera2D" as T0 #87CEFA
participant "$OldWoman\n/LaughingParticles2D" as T2 #87CEFA



== Time: 0.0 ==
R  ->  T0 : zoom\n = Vector2(2, 2)
== Time: 1.0 ==
R  ->  T0 : zoom\n = Vector2(1, 1)
R  ->o  T0 : enabled\n = false
R  ->o  T2 : visible\n = true


....
---



=== Properties
[.node-property.node-2d]
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*script* a|link:/scripts/src/dialogue/chapters/0/stage_0.gd[res://src/dialogue/chapters/0/stage_0.gd]
|===
[.node-property.node-other]
.#$Dialogue# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*visible* a|`false`
|*boot_file* a|link:/assets/src/dialogue/scenarios/chapter0/stage0.ja.rb[res://src/dialogue/scenarios/chapter0/stage0.ja.rb]
|*speakers* a|`Array("[SubResource("Resource_ffs01"), SubResource("Resource_gkg18")]")`
|===
[.node-property.node-2d]
.#$House# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(881, 473)`
|*scale* a|`Vector2(10, 10)`
|*texture* a|[link=/assets/assets/images/stages/chapter0/House.png]
[.asset-image]
.res://assets/images/stages/chapter0/House.png
image::/assets/raw/assets/images/stages/chapter0/House.png[]

|===
[.node-property.node-2d]
.#$OldWoman# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(968, 672)`
|===
[.node-property.node-2d]
.#$OldWoman/LaughingParticles2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*visible* a|`false`
|*position* a|`Vector2(16.88889, -19.555555)`
|*amount* a|`2`
|*texture* a|[link=/assets/assets/images/particles/HA.png]
[.asset-image]
.res://assets/images/particles/HA.png
image::/assets/raw/assets/images/particles/HA.png[]

|*preprocess* a|`5.08`
|*gravity* a|`Vector2(400, -150)`
|*tangential_accel_min* a|`-100.0`
|*tangential_accel_max* a|`100.0`
|*scale_amount_min* a|`2.5`
|*scale_amount_max* a|`2.6`
|===
[.node-property.node-2d]
.#$EventArea2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*collision_layer* a|`16`
|*collision_mask* a|`16`
|===
[.node-property.node-2d]
.#$EventArea2D/CollisionShape2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(486, 138)`
|*shape* a|`SubResource("RectangleShape2D_6qvxh")`
|===
[.node-property.node-2d]
.#$Camera2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*position* a|`Vector2(960, 540)`
|*ignore_rotation* a|`false`
|*enabled* a|`false`
|===
[.node-property.node-other]
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*libraries* a|`{
&"": SubResource("AnimationLibrary_7eiyn")
}`
|===


=== link:/scripts/src/dialogue/chapters/0/stage_0.gd[stage_0.gd]

```gdscript
extends Node2D

signal event(event_name: String)

var started : bool = false


func _ready() -> void:
	if not owner: start()


func start() -> void:
	if started: return
	started = true
	%Camera2D.enabled = true
	%Camera2D.make_current()
	%Dialogue.start()


func _on_event_area_2d_area_entered(_area: Area2D) -> void:
	start()


func _on_dialogue_event(event_name: String) -> void:
	var key = "event_%s" % event_name
	if %AnimationPlayer.has_animation(key):
		%AnimationPlayer.play(key)
	event.emit(event_name)


func _on_dialogue_finished() -> void:
	%AnimationPlayer.play('finished')

```


