---
title: src/beginning/chapters/chapters.tscn
---
:toc:

== src / beginning / chapters / chapters.tscn

=== Diagram
[plantuml]
....
class R as "Chapters" <<(C,lightgreen) Control>> {
  ~ focused
  ~ selected
  ~ ui_backed
---
  - ICON_OFFSET
  - INITIAL_CHAPTERS_X
  * grab_focus_first
  * play_opening
  * current_plate
  * shown
  * focused_chapter_idx
  * selected_chapter_idx
---
  + _ready()
  + setup_from_account_resource()
  + _input()
  + go_back()
  + go_foward()
  + set_grab_focus_first()
  + set_play_opening()
  + focus_pin_to()
  + zoom_pin_to()
  + force_focus_return()
  + load_focused_chapter_to_menu()
  + get_chapter()
  + set_chapters_animation_offset()
  + _on_chapater_focused()
  + _on_animation_player_animation_finished()
  + _on_selected()
  + _on_menu_ui_backed()
}
class N1 as "Banner" <<(T,lightgreen) TextureRect>> {
}
class N2 as "ChaptersContainer" <<(H,lightgreen) HBoxContainer>> {
}
class N3 as "Chapter_0" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N4 as "Chapter_1" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N5 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N6 as "Chapter_2" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N7 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N8 as "Chapter_3" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N9 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N10 as "Chapter_4" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N11 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N12 as "Chapter_5" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N13 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N14 as "Chapter_6" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N15 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N16 as "Chapter_7" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N17 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N18 as "Chapter_8" <<(M,lightgreen) MarginContainer>> {
  * play_opening
  * resource
  * focus_animation_skip
---
  + set_play_opening()
  + focus_returned()
  + selected()
  + unselected()
  + _on_focus_entered()
}
class N19 as "Sprite2D" <<(N,darkgray) Node>> {
}
class N20 as "Grid1920x1080" <<(S,lightskyblue) Sprite2D>> {
}
class N21 as "Pin" <<(N,lightskyblue) Node2D>> {
}
class N22 as "Menu" <<(C,lightgreen) Control>> {
  ~ ui_backed
  ~ get_started
---
  * grab_focus_first
  * grab_focus_side
  * grab_focus_stage
  * shown
  * chapter_resource
  * state
  * chapter_number
  * stage_resources
---
  + _ready()
  + load_chapter()
  + load_chapter_stages()
  + setup_from_account_resource()
  + set_grab_focus_first()
  + set_grab_focus_side()
  + set_grab_focus_stage()
  + clear_photos()
  + add_photo()
  + clear_stage_buttons()
  + add_stage_button()
  + get_stage_button()
  + hide_stage_button_and_photo()
  + stages_count()
  + _input()
  + _on_climb_button_pressed()
  + _on_stage_button_focus_entered()
  + _on_stage_button_pressed()
  + _on_ui_backed()
  + _on_get_started()
}
class N23 as "ChaptersAnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
class N24 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N20
R --o N21
R --o N22
R --o N23
R --o N24
N2 --o N3
N2 --o N4
N2 --o N6
N2 --o N8
N2 --o N10
N2 --o N12
N2 --o N14
N2 --o N16
N2 --o N18
N4 --o N5
N6 --o N7
N8 --o N9
N10 --o N11
N12 --o N13
N14 --o N15
N16 --o N17
N18 --o N19
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction
_(R::_on_selected, R::selected)
_(R::_on_menu_ui_backed, N22::ui_backed)
_(R::_on_animation_player_animation_finished, N24::animation_finished)
....


=== Assets
[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_1.png
[link=/assets/assets/images/ui/Chapters/Chapter_1.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_1.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_2.png
[link=/assets/assets/images/ui/Chapters/Chapter_2.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_2.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_3.png
[link=/assets/assets/images/ui/Chapters/Chapter_3.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_3.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_4.png
[link=/assets/assets/images/ui/Chapters/Chapter_4.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_4.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_5.png
[link=/assets/assets/images/ui/Chapters/Chapter_5.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_5.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_6.png
[link=/assets/assets/images/ui/Chapters/Chapter_6.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_6.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_7.png
[link=/assets/assets/images/ui/Chapters/Chapter_7.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_7.png[200, 100] 

[.scene-assets]
.res://assets/guide/grid_1920x1080.png
[link=/assets/assets/guide/grid_1920x1080.png] 
image::/assets/raw/assets/guide/grid_1920x1080.png[200, 100] 

[.scene-assets]
.res://assets/images/ui/Chapters/Chapter_8.png
[link=/assets/assets/images/ui/Chapters/Chapter_8.png] 
image::/assets/raw/assets/images/ui/Chapters/Chapter_8.png[200, 100] 



=== Overridden virtual functions
==== _ready
```gdscript
func _ready() -> void:
	if get_parent() == get_tree().root:
		%AnimationPlayer.play('opening')
	FocusHelper.set_neighbors_h(%ChaptersContainer.get_children())
	for chapter in %ChaptersContainer.get_children():
		chapter.focus_entered.connect(_on_chapater_focused.bind(chapter))
	load_focused_chapter_to_menu()
```
.$Menu
```gdscript
func _ready() -> void:
	if get_parent() == get_tree().root:
		%AnimationPlayer.play('show')
	FocusHelper.set_neighbors_h(%SideButtonContainer.get_children())
	FocusHelper.set_neighbors_h(%StageButtonContainer.get_children())
```
==== _input
```gdscript
func _input(event: InputEvent) -> void:
	if not (shown && current_plate == Plate.ROOT): return
	if event.is_action_pressed("ui_back"):
		go_back()
	elif event.is_action_pressed("ui_accept"):
		go_foward()
```
.$Menu
```gdscript
func _input(event: InputEvent) -> void:
	if not shown: return
	if event.is_action_pressed("ui_back"):
		match state:
			State.UNSELECTED: ui_backed.emit()
			State.SELECTED:
				state = State.UNSELECTED
				%AnimationPlayer.play("climb_unselected")
```


=== Instantiators
* link:/scenes/debug/chapters/chapters.tscn[res://debug/chapters/chapters.tscn]
* link:/scenes/src/beginning/menu/menu.tscn[res://src/beginning/menu/menu.tscn]


=== Scene Tree
[.scene-tree]
* [.node-name.type-control]#Chapters# [.node-type.type-control]#Control#
** [.node-name.type-control]#Banner# [.node-type.type-control]#link:/scenes/src/beginning/chapters/banner/banner.tscn[res://src/beginning/chapters/banner/banner.tscn]#
** [.node-name.type-control]#ChaptersContainer# [.node-type.type-control]#HBoxContainer#
*** [.node-name.type-control]#Chapter_0# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
*** [.node-name.type-control]#Chapter_1# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_2# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_3# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_4# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_5# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_6# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_7# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
*** [.node-name.type-control]#Chapter_8# [.node-type.type-control]#link:/scenes/src/beginning/chapters/chapter/chapter.tscn[res://src/beginning/chapters/chapter/chapter.tscn]#
**** [.node-name.type-plain]#Sprite2D# [.node-type.type-plain]#Node#
** [.node-name.type-2d]#Grid1920x1080# [.node-type.type-2d]#Sprite2D#
** [.node-name.type-2d]#Pin# [.node-type.type-2d]#link:/scenes/src/world/pin/pin.tscn[res://src/world/pin/pin.tscn]#
** [.node-name.type-control]#Menu# [.node-type.type-control]#link:/scenes/src/beginning/chapters/menu/menu.tscn[res://src/beginning/chapters/menu/menu.tscn]#
** [.node-name.type-other]#ChaptersAnimationPlayer# [.node-type.type-other]#AnimationPlayer#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
[.signal-connection]
.$.:[#_selected_#]=>$.
```gdscript
func _on_selected(idx: int) -> void:
	%Menu.grab_focus_first = true
	selected_chapter_idx = idx
	zoom_pin_to(idx)
	get_chapter(idx).selected()
	set_chapters_animation_offset()
	%ChaptersAnimationPlayer.play("selected")
	current_plate = Plate.MENU
```
[.signal-connection]
.$Menu:[#_ui_backed_#]=>$.
```gdscript
func _on_menu_ui_backed() -> void:
	if current_plate == Plate.MENU:
		(func(): current_plate = Plate.ROOT).call_deferred()
		get_chapter(selected_chapter_idx).unselected()
		%ChaptersAnimationPlayer.play("unselected")
		selected_chapter_idx = -1
		force_focus_return()
```
[.signal-connection]
.$AnimationPlayer:[#_animation_finished_#]=>$.
```gdscript
func _on_animation_player_animation_finished(_anim_name: StringName) -> void:
	if current_plate == Plate.ROOT:
		force_focus_return()
```


=== Animations
==== Animation_f7nbf

[plantuml]
....
control "Root" as R
participant "$%ChaptersContainer\n/..\n/Banner" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(800, -250)
R  ->  R : position\n = Vector2(815, -250)


....
---

==== selected

[plantuml]
....
control "Root" as R
participant "$%ChaptersContainer\n/..\n/Banner" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(800, 0)
R  ->  R : position\n = Vector2(815, 8)
== Time: 1.0 ==
R  ->  T0 : position\n = Vector2(800, -250)
R  ->  R : position\n = Vector2(815, -250)


....
---

==== unselected

[plantuml]
....
control "Root" as R
participant "$%ChaptersContainer\n/..\n/Banner" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(800, -250)
R  ->  R : position\n = Vector2(815, -250)
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(800, 0)
R  ->  R : position\n = Vector2(815, 8)


....
---

==== Animation_xd314

[plantuml]
....
control "Root" as R
participant "$Banner" as T0
participant "$ChaptersContainer" as T1
participant "$ChaptersContainer\n/Chapter_0" as T2
participant "$ChaptersContainer\n/Chapter_1" as T3
participant "$ChaptersContainer\n/Chapter_2" as T4
participant "$ChaptersContainer\n/Chapter_3" as T5
participant "$ChaptersContainer\n/Chapter_4" as T6
participant "$ChaptersContainer\n/Chapter_5" as T7
participant "$ChaptersContainer\n/Chapter_6" as T8
participant "$ChaptersContainer\n/Chapter_7" as T9
participant "$ChaptersContainer\n/Chapter_8" as T10
participant "$Pin" as T20
participant "$Menu" as T25



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(800, -220)
R  ->  T1 : position\n = Vector2(815, -150)
R  ->o  T2 : play_opening\n = false
R  ->o  T3 : play_opening\n = false
R  ->o  T4 : play_opening\n = false
R  ->o  T5 : play_opening\n = false
R  ->o  T6 : play_opening\n = false
R  ->o  T7 : play_opening\n = false
R  ->o  T8 : play_opening\n = false
R  ->o  T9 : play_opening\n = false
R  ->o  T10 : play_opening\n = false
R  ->o  T2 : visible\n = true
R  ->o  T3 : visible\n = true
R  ->o  T4 : visible\n = true
R  ->o  T5 : visible\n = true
R  ->o  T6 : visible\n = true
R  ->o  T7 : visible\n = true
R  ->o  T8 : visible\n = true
R  ->o  T9 : visible\n = true
R  ->o  T10 : visible\n = true
R  ->  T20 : position\n = Vector2(903, 554)
R  ->  T20 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T20 : visible\n = false
R  ->o  R : shown\n = false
R  ->o  R : current_plate\n = 0
R  ->  T25 : position\n = Vector2(960, 0)


....
---

==== focus_pin_to_chapter_0

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1039, 648)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_1

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1064, 682)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_2

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1046, 389)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_3

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(843, 545)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_4

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(939, 674)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_5

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(752, 514)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_6

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1156, 857)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_7

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1019, 404)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
== Time: 1.0 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== focus_pin_to_chapter_8

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1051, 612)
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
== Time: 1.0 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)


....
---

==== opening

[plantuml]
....
control "Root" as R
participant "$Banner" as T0
participant "$ChaptersContainer" as T1
participant "$ChaptersContainer\n/Chapter_0" as T2
participant "$ChaptersContainer\n/Chapter_1" as T3
participant "$ChaptersContainer\n/Chapter_2" as T4
participant "$ChaptersContainer\n/Chapter_3" as T5
participant "$ChaptersContainer\n/Chapter_4" as T6
participant "$ChaptersContainer\n/Chapter_5" as T7
participant "$ChaptersContainer\n/Chapter_6" as T8
participant "$ChaptersContainer\n/Chapter_7" as T9
participant "$ChaptersContainer\n/Chapter_8" as T10
participant "$Pin" as T20



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(800, -250)
R  ->  T1 : position\n = Vector2(815, -150)
R  ->o  T2 : play_opening\n = false
R  ->o  T3 : play_opening\n = false
R  ->o  T4 : play_opening\n = false
R  ->o  T5 : play_opening\n = false
R  ->o  T6 : play_opening\n = false
R  ->o  T7 : play_opening\n = false
R  ->o  T8 : play_opening\n = false
R  ->o  T9 : play_opening\n = false
R  ->o  T10 : play_opening\n = false
R  ->o  T2 : visible\n = false
R  ->o  T3 : visible\n = false
R  ->o  T4 : visible\n = false
R  ->o  T5 : visible\n = false
R  ->o  T6 : visible\n = false
R  ->o  T7 : visible\n = false
R  ->o  T8 : visible\n = false
R  ->o  T9 : visible\n = false
R  ->o  T10 : visible\n = false
R  ->o  T20 : visible\n = false
== Time: 0.0666667 ==
R  ->o  T2 : visible\n = true
== Time: 0.066667 ==
R  ->o  T2 : play_opening\n = true
== Time: 0.133333 ==
R  ->o  T3 : play_opening\n = true
R  ->o  T3 : visible\n = true
== Time: 0.2 ==
R  ->o  T4 : play_opening\n = true
R  ->o  T4 : visible\n = true
== Time: 0.266667 ==
R  ->o  T5 : play_opening\n = true
R  ->o  T5 : visible\n = true
== Time: 0.333333 ==
R  ->o  T6 : play_opening\n = true
R  ->o  T6 : visible\n = true
== Time: 0.4 ==
R  ->o  T7 : play_opening\n = true
R  ->o  T7 : visible\n = true
== Time: 0.466666 ==
R  ->o  T8 : play_opening\n = true
== Time: 0.466667 ==
R  ->  T1 : position\n = Vector2(815, -150)
R  ->o  T8 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(800, 0)
== Time: 0.533333 ==
R  ->o  T9 : play_opening\n = true
R  ->o  T9 : visible\n = true
== Time: 0.6 ==
R  ->o  T10 : play_opening\n = true
R  ->o  T10 : visible\n = true
== Time: 0.7 ==
R  ->  T1 : position\n = Vector2(815, 8)
R  ->o  R : shown\n = true


....
---

==== zoom_pin_to_chapter_0

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1039, 648)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(868, 600)


....
---

==== zoom_pin_to_chapter_1

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1064, 682)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(847, 597)


....
---

==== zoom_pin_to_chapter_2

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1046, 389)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(977, 374)


....
---

==== zoom_pin_to_chapter_3

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(843, 545)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(962, 462)


....
---

==== zoom_pin_to_chapter_4

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(939, 674)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(887, 757)


....
---

==== zoom_pin_to_chapter_5

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(752, 514)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(949, 348)


....
---

==== zoom_pin_to_chapter_6

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1156, 857)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(704, 680)


....
---

==== zoom_pin_to_chapter_7

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1019, 404)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(1040, 355)


....
---

==== zoom_pin_to_chapter_8

[plantuml]
....
control "Root" as R
participant "$Pin" as T0



== Time: 0.0 ==
R  ->  T0 : position\n = Vector2(1051, 612)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->o  T0 : visible\n = true
== Time: 0.5 ==
R  ->  T0 : position\n = Vector2(1060, 719)


....
---



=== Properties
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`3`
|*anchors_preset* |`15`
|*anchor_right* |`1.0`
|*anchor_bottom* |`1.0`
|*grow_horizontal* |`2`
|*grow_vertical* |`2`
|*script* |`ExtResource("1_k1tcw")`
|===
.#$Banner# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`1`
|*anchors_preset* |`-1`
|*anchor_left* |`0.469`
|*anchor_right* |`0.469`
|*offset_left* |`-100.48`
|*offset_top* |`-250.0`
|*offset_right* |`99.52`
|*offset_bottom* |`-50.0`
|===
.#$ChaptersContainer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*layout_mode* |`1`
|*anchors_preset* |`10`
|*anchor_right* |`1.0`
|*offset_left* |`815.0`
|*offset_top* |`-250.0`
|*offset_right* |`817.0`
|*offset_bottom* |`-82.0`
|*grow_horizontal* |`2`
|===
.#$ChaptersContainer/Chapter_0# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath(".")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_1")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_1")`
|*focus_previous* |`NodePath(".")`
|*resource* |`ExtResource("4_p776p")`
|===
.#$ChaptersContainer/Chapter_1# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_0")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_2")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_2")`
|*focus_previous* |`NodePath("../Chapter_0")`
|*resource* |`ExtResource("5_nuakg")`
|===
.#$ChaptersContainer/Chapter_1/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("3_6pmeh")`
|===
.#$ChaptersContainer/Chapter_2# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_1")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_3")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_3")`
|*focus_previous* |`NodePath("../Chapter_1")`
|*resource* |`ExtResource("7_vbe55")`
|===
.#$ChaptersContainer/Chapter_2/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("4_bn10p")`
|===
.#$ChaptersContainer/Chapter_3# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_2")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_4")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_4")`
|*focus_previous* |`NodePath("../Chapter_2")`
|*resource* |`ExtResource("9_v7ooo")`
|===
.#$ChaptersContainer/Chapter_3/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("5_fq7id")`
|===
.#$ChaptersContainer/Chapter_4# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_3")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_5")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_5")`
|*focus_previous* |`NodePath("../Chapter_3")`
|*resource* |`ExtResource("11_mdrma")`
|===
.#$ChaptersContainer/Chapter_4/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("6_x2qy8")`
|===
.#$ChaptersContainer/Chapter_5# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_4")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_6")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_6")`
|*focus_previous* |`NodePath("../Chapter_4")`
|*resource* |`ExtResource("13_y01i1")`
|===
.#$ChaptersContainer/Chapter_5/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("7_nb1nd")`
|===
.#$ChaptersContainer/Chapter_6# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_5")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_7")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_7")`
|*focus_previous* |`NodePath("../Chapter_5")`
|*resource* |`ExtResource("15_hivwg")`
|===
.#$ChaptersContainer/Chapter_6/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("8_xsadn")`
|===
.#$ChaptersContainer/Chapter_7# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_6")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath("../Chapter_8")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath("../Chapter_8")`
|*focus_previous* |`NodePath("../Chapter_6")`
|*resource* |`ExtResource("17_7yar7")`
|===
.#$ChaptersContainer/Chapter_7/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("9_meg0j")`
|===
.#$ChaptersContainer/Chapter_8# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*layout_mode* |`2`
|*focus_neighbor_left* |`NodePath("../Chapter_7")`
|*focus_neighbor_top* |`NodePath(".")`
|*focus_neighbor_right* |`NodePath(".")`
|*focus_neighbor_bottom* |`NodePath(".")`
|*focus_next* |`NodePath(".")`
|*focus_previous* |`NodePath("../Chapter_7")`
|*resource* |`ExtResource("19_klsch")`
|===
.#$ChaptersContainer/Chapter_8/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* |`ExtResource("11_o1xm2")`
|===
.#$Grid1920x1080# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*visible* |`false`
|*position* |`Vector2(960, 540)`
|*texture* |`ExtResource("11_2qc6p")`
|===
.#$Pin# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*visible* |`false`
|*position* |`Vector2(903, 554)`
|*scale* |`Vector2(0.5, 0.5)`
|===
.#$Menu# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*layout_mode* |`1`
|===
.#$ChaptersAnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*root_node* |`NodePath("../ChaptersContainer")`
|*libraries* |`{
&"": SubResource("AnimationLibrary_c4ypt")
}`
|===
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*libraries* |`{
&"": SubResource("AnimationLibrary_wkduh")
}`
|===


=== link:/scripts/src/beginning/chapters/chapters.gd[chapters.gd]

```gdscript
extends Control

signal focused(idx: int)
signal selected(idx: int)
signal ui_backed

@export var grab_focus_first : bool : set = set_grab_focus_first
@export var play_opening := false : set = set_play_opening
@export var current_plate : Plate = Plate.ROOT
@export var shown : bool = false
enum Plate { ROOT, MENU }
const ICON_OFFSET := 164
const INITIAL_CHAPTERS_X := 815
var focused_chapter_idx : int = 0
var selected_chapter_idx : int = -1


func _ready() -> void:
	if get_parent() == get_tree().root:
		%AnimationPlayer.play('opening')
	FocusHelper.set_neighbors_h(%ChaptersContainer.get_children())
	for chapter in %ChaptersContainer.get_children():
		chapter.focus_entered.connect(_on_chapater_focused.bind(chapter))
	load_focused_chapter_to_menu()


func setup_from_account_resource() -> void:
	if not Current.account: return
	var numbers = Current.account.chapters.map(func(c): return c.number)
	for chapter in %ChaptersContainer.get_children():
		var number = int(str(chapter.name)[-1])
		if number == 0: continue
		if not numbers.has(number): chapter.hide()


func _input(event: InputEvent) -> void:
	if not (shown && current_plate == Plate.ROOT): return
	if event.is_action_pressed("ui_back"):
		go_back()
	elif event.is_action_pressed("ui_accept"):
		go_foward()


func go_back() -> void:
	shown = false
	%AnimationPlayer.play("RESET")
	ui_backed.emit()


func go_foward() -> void:
	current_plate = Plate.MENU
	selected.emit(focused_chapter_idx)


func set_grab_focus_first(val: bool) -> void:
	FocusHelper.grab_first(%ChaptersContainer, val)


func set_play_opening(val: bool) -> void:
	if val: %AnimationPlayer.play("opening")


func focus_pin_to(idx: int) -> void:
	var anim_name = "focus_pin_to_chapter_%s" % idx
	if shown: %AnimationPlayer.play(anim_name)
	else: %AnimationPlayer.queue(anim_name)


func zoom_pin_to(idx: int) -> void:
	var anim_name = "zoom_pin_to_chapter_%s" % idx
	%AnimationPlayer.play(anim_name)


func force_focus_return():
	var target = get_chapter(focused_chapter_idx)
	if not FocusHelper.is_focuesed(target):
		target.focus_returned()


func load_focused_chapter_to_menu():
	var chapter = get_chapter(focused_chapter_idx)
	%Menu.chapter_resource = chapter.resource


func get_chapter(idx: int) -> Node:
	return %ChaptersContainer.get_child(idx)


func set_chapters_animation_offset() -> void:
	var current_pos = %ChaptersContainer.position
	var anim = %ChaptersAnimationPlayer.get_animation('selected')
	var track_idx = anim.find_track('.:position', Animation.TrackType.TYPE_VALUE)
	anim.track_set_key_value(track_idx, 0, current_pos)
	var pos = anim.track_get_key_value(track_idx, 1)
	pos.x = current_pos.x
	anim.track_set_key_value(track_idx, 1, pos)
	anim = %ChaptersAnimationPlayer.get_animation('unselected')
	track_idx = anim.find_track('.:position', Animation.TrackType.TYPE_VALUE)
	pos = anim.track_get_key_value(track_idx, 0)
	pos.x = current_pos.x
	anim.track_set_key_value(track_idx, 0, pos)
	anim.track_set_key_value(track_idx, 1, current_pos)


func _on_chapater_focused(chapter: Node) -> void:
	var idx = int(str(chapter.name)[-1])
	focused_chapter_idx = idx
	%ChaptersContainer.position.x = INITIAL_CHAPTERS_X - (ICON_OFFSET * idx)
	focus_pin_to(idx)
	load_focused_chapter_to_menu()
	focused.emit(idx)


func _on_animation_player_animation_finished(_anim_name: StringName) -> void:
	if current_plate == Plate.ROOT:
		force_focus_return()


func _on_selected(idx: int) -> void:
	%Menu.grab_focus_first = true
	selected_chapter_idx = idx
	zoom_pin_to(idx)
	get_chapter(idx).selected()
	set_chapters_animation_offset()
	%ChaptersAnimationPlayer.play("selected")
	current_plate = Plate.MENU


func _on_menu_ui_backed() -> void:
	if current_plate == Plate.MENU:
		(func(): current_plate = Plate.ROOT).call_deferred()
		get_chapter(selected_chapter_idx).unselected()
		%ChaptersAnimationPlayer.play("unselected")
		selected_chapter_idx = -1
		force_focus_return()

```


