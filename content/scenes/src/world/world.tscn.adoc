---
title: src/world/world.tscn
---
:toc:

== src / world / world.tscn

=== Diagram
[plantuml]
....
class R as "World" <<(N,hotpink) Node3D>> {
  * CameraNode
---
  + back_to_circular_move()
  + focus_chapter()
  + zoom_chapter()
  + initialize_animation_camera_key()
  + smooth_rotation()
  + acute_angle()
  + _on_animation_player_animation_finished()
}
class N1 as "Mountain" <<(N,darkgray) Node>> {
}
class N2 as "SpotLights" <<(N,darkgray) Node>> {
}
class N3 as "Chapter0" <<(S,hotpink) SpotLight3D>> {
}
class N4 as "Chapter1" <<(S,hotpink) SpotLight3D>> {
}
class N5 as "Chapter2_1" <<(S,hotpink) SpotLight3D>> {
}
class N6 as "Chapter2_2" <<(S,hotpink) SpotLight3D>> {
}
class N7 as "Chapter3" <<(S,hotpink) SpotLight3D>> {
}
class N8 as "Chapter8" <<(S,hotpink) SpotLight3D>> {
}
class N9 as "DirectionalLight3D" <<(D,hotpink) DirectionalLight3D>> {
}
class N10 as "WorldEnvironment" <<(W,yellow) WorldEnvironment>> {
}
class N11 as "Path3D" <<(P,hotpink) Path3D>> {
}
class N12 as "PathFollow3D" <<(P,hotpink) PathFollow3D>> {
}
class N13 as "Camera3D" <<(C,hotpink) Camera3D>> {
}
class N14 as "Blinder" <<(C,lightgreen) ColorRect>> {
}
class N15 as "Mist" <<(N,lightskyblue) Node2D>> {
}
class N16 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N9
R --o N10
R --o N11
R --o N14
R --o N15
R --o N16
N2 --o N3
N2 --o N4
N2 --o N5
N2 --o N6
N2 --o N7
N2 --o N8
N11 --o N12
N12 --o N13
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction
_(R::_on_animation_player_animation_finished, N16::animation_finished)
....


=== Assets
[.scene-assets]
.res://assets/world/Panorama.png
[link=/assets/assets/world/Panorama.png] 
image::/assets/raw/assets/world/Panorama.png[200, 100] 





=== Instantiators
* link:/scenes/src/beginning/menu/menu.tscn[res://src/beginning/menu/menu.tscn]


=== Scene Tree
[.scene-tree]
* [.node-name.type-3d]#World# [.node-type.type-3d]#Node3D#
** [.node-name.type-plain]#Mountain# [.node-type.type-plain]#Node#
** [.node-name.type-plain]#SpotLights# [.node-type.type-plain]#Node#
*** [.node-name.type-3d]#Chapter0# [.node-type.type-3d]#SpotLight3D#
*** [.node-name.type-3d]#Chapter1# [.node-type.type-3d]#SpotLight3D#
*** [.node-name.type-3d]#Chapter2_1# [.node-type.type-3d]#SpotLight3D#
*** [.node-name.type-3d]#Chapter2_2# [.node-type.type-3d]#SpotLight3D#
*** [.node-name.type-3d]#Chapter3# [.node-type.type-3d]#SpotLight3D#
*** [.node-name.type-3d]#Chapter8# [.node-type.type-3d]#SpotLight3D#
** [.node-name.type-3d]#DirectionalLight3D# [.node-type.type-3d]#DirectionalLight3D#
** [.node-name.type-other]#WorldEnvironment# [.node-type.type-other]#WorldEnvironment#
** [.node-name.type-3d]#Path3D# [.node-type.type-3d]#Path3D#
*** [.node-name.type-3d]#PathFollow3D# [.node-type.type-3d]#PathFollow3D#
**** [.node-name.type-3d]#Camera3D# [.node-type.type-3d]#Camera3D#
** [.node-name.type-control]#Blinder# [.node-type.type-control]#ColorRect#
** [.node-name.type-2d]#Mist# [.node-type.type-2d]#link:/scenes/src/world/mist/mist.tscn[res://src/world/mist/mist.tscn]#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
[.signal-connection]
.$AnimationPlayer:[#_animation_finished_#]=>$.
```gdscript
func _on_animation_player_animation_finished(anim_name: StringName) -> void:
	match anim_name:
		'opening': %AnimationPlayer.play('circular_move')
		'back_to_circular_move': %AnimationPlayer.play('circular_move')
		_: pass
```


=== Animations
==== Animation_kwh1a

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D" as T0
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T1
participant "$Blinder" as T3
participant "$Mountain\n/MountainCoreSurface" as T5
participant "$WorldEnvironment" as T6
participant "$Mist" as T7



== Time: 0.0 ==
R  ->  T0 : progress_ratio\n = 0.0
R  ->  T1 : position\n = Vector3(0.52904, 0.621466, -0.783036)
R  ->  T1 : rotation\n = Vector3(-0.0879928, -2.11665, 0.000439632)
R  ->  T3 : modulate\n = Color(0, 0, 0, 0.784314)
R  ->  T0 : h_offset\n = -0.005
R  ->  T5 : blend_shapes/Hide\n = 0.0
R  ->  T6 : environment\n = 0.0
R  ->o  T7 : visible\n = true
R  ->  T7 : modulate\n = Color(1, 1, 1, 1)


....
---

==== back_to_circular_move

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$WorldEnvironment" as T3



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.887, 0.0630711, -0.405323)
R  ->  T0 : rotation\n = Vector3(-0.0655383, 1.96273, 0.00803841)
R  ->  T3 : environment\n = 0.0
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(0.529, 0.621, -0.783)
R  ->  T0 : rotation\n = Vector3(-0.0872665, 4.18879, 0)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== circular_move

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D" as T0
participant "$Blinder" as T1
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T3
participant "$WorldEnvironment" as T5
participant "$Mist" as T6


loop
== Time: 0.0 ==
R  ->  T0 : progress_ratio\n = 0.0
R  ->  T1 : modulate\n = Color(0, 0, 0, 0)
R  ->  T0 : h_offset\n = 0.0
R  ->  T3 : position\n = Vector3(0.52904, 0.621466, -0.783036)
R  ->  T3 : rotation\n = Vector3(-0.0872665, 4.18879, 0)
R  ->  T5 : environment\n = 0.0
R  ->o  T6 : visible\n = true
R  ->  T6 : modulate\n = Color(1, 1, 1, 0)
== Time: 2.0 ==
R  ->  T6 : modulate\n = Color(1, 1, 1, 1)
== Time: 60.0 ==
R  ->  T0 : progress_ratio\n = 1.0
R  ->  T0 : h_offset\n = 0.0

end
....
---

==== focus_chapter_0

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(0.529, 0.621, -0.783)
R  ->  T0 : rotation\n = Vector3(-0.0872665, -2.0944, 0)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = -0.1
R  ->o  T5 : visible\n = false
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(2.887, 0.0630711, -0.405323)
R  ->  T0 : rotation\n = Vector3(-0.0663225, 1.91986, 0.00872665)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== focus_chapter_1

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.887, 0.063, -0.405)
R  ->  T0 : rotation\n = Vector3(-0.0663225, 1.91986, 0.00872665)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(2.27175, 0.33458, -0.958952)
R  ->  T0 : rotation\n = Vector3(-0.239332, 2.68677, -0.00974663)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T4 : environment\n = -0.08


....
---

==== focus_chapter_2

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.272, 0.335, -0.959)
R  ->  T0 : rotation\n = Vector3(-0.23911, 2.68606, -0.010472)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(1.72521, 0.334661, -0.878079)
R  ->  T0 : rotation\n = Vector3(-0.23926, 2.89845, -0.00954221)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T4 : environment\n = -0.05


....
---

==== focus_chapter_3

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.725, 0.335, -0.878)
R  ->  T0 : rotation\n = Vector3(-0.23911, 2.89899, -0.00872665)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 0.666667 ==
R  ->  T4 : environment\n = 0.0
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(1.048, 0.454, -0.205)
R  ->  T0 : rotation\n = Vector3(-0.298451, -1.74533, 0.00523599)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== focus_chapter_4

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.048, 0.524, -0.205)
R  ->  T0 : rotation\n = Vector3(-0.0872665, -2.0944, 0)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 0.633333 ==
R  ->  T4 : environment\n = 0.1
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(0.89739, 0.524141, 0.372991)
R  ->  T0 : rotation\n = Vector3(-0.197222, -1.309, 0.0383972)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== focus_chapter_5

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(0.897, 0.524, 0.373)
R  ->  T0 : rotation\n = Vector3(-0.0872665, -2.0944, 0)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(1.505, 0.533, 0.685)
R  ->  T0 : rotation\n = Vector3(-0.139626, -0.523599, 0.0733038)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T4 : environment\n = 0.2


....
---

==== focus_chapter_6

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.505, 0.608, 0.685)
R  ->  T0 : rotation\n = Vector3(-0.139626, -0.523599, 0.0733038)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(2.6676, 0.843824, 0.187534)
R  ->  T0 : rotation\n = Vector3(-0.249582, 1.46259, 0.0139626)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T4 : environment\n = 0.6


....
---

==== focus_chapter_7

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.668, 0.844, 0.188)
R  ->  T0 : rotation\n = Vector3(-0.249582, 1.46259, 0.0139626)
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 0.633333 ==
R  ->  T4 : environment\n = 0.75
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(2.238, 0.179, -1.871)
R  ->  T0 : rotation\n = Vector3(0.307178, 3.01942, 0.00174533)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== focus_chapter_8

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.238, 0.179, -1.871)
R  ->  T0 : rotation\n = Vector3(0.307178, 3.01942, 0.00174533)
R  ->  T3 : blend_shapes/Hide\n = 1.0
R  ->o  T5 : visible\n = false
== Time: 0.666667 ==
R  ->  T4 : environment\n = 1.0
== Time: 1.0 ==
R  ->  T0 : position\n = Vector3(1.957, 0.82, -0.531)
R  ->  T0 : rotation\n = Vector3(-0.406981, 3.12041, 0.0460821)
R  ->  T2 : progress_ratio\n = 0.0


....
---

==== opening (autoplay)

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D" as T0
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T1
participant "$Blinder" as T3
participant "$Mountain\n/MountainCoreSurface" as T4
participant "$WorldEnvironment" as T5
participant "$Mist" as T6



== Time: 0.0 ==
R  ->  T0 : progress_ratio\n = 0.0
R  ->  T1 : position\n = Vector3(0.299, 0.621, -0.968)
R  ->  T1 : rotation\n = Vector3(-0.195477, 4.18879, 0)
R  ->  T3 : modulate\n = Color(0.141176, 0.129412, 0.223529, 1)
R  ->  T4 : blend_shapes/Hide\n = 0.0
R  ->  T5 : environment\n = 0.0
R  ->o  T6 : visible\n = false
== Time: 1.0 ==
R  ->  T1 : position\n = Vector3(0.52904, 0.621466, -0.783036)
R  ->  T1 : rotation\n = Vector3(-0.0872665, 4.18879, 0)
R  ->  T3 : modulate\n = Color(0, 0, 0, 0)


....
---

==== zoom_chapter_0

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.887, 0.0630711, -0.405323)
R  ->  T0 : rotation\n = Vector3(-0.0663225, 1.91986, 0.00872665)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 
R  ->  T4 : environment\n = -0.1
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(2.627, 0.072, -0.594)
R  ->  T0 : rotation\n = Vector3(-0.190241, 2.78904, 0.0279253)


....
---

==== zoom_chapter_1

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.27175, 0.33458, -0.958952)
R  ->  T0 : rotation\n = Vector3(-0.239332, 2.68677, -0.00974663)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = -0.08
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(2.095, 0.153, -0.811)
R  ->  T0 : rotation\n = Vector3(0.00872665, 2.77507, 0.0226893)


....
---

==== zoom_chapter_2

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.72521, 0.334661, -0.878079)
R  ->  T0 : rotation\n = Vector3(-0.23926, 2.89845, -0.00954221)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = -0.05
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(1.54829, 0.245408, -0.742679)
R  ->  T0 : rotation\n = Vector3(0.0820305, 3.49589, -0.0174533)


....
---

==== zoom_chapter_3

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.048, 0.454, -0.205)
R  ->  T0 : rotation\n = Vector3(-0.298451, -1.74533, 0.00523599)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = 0.0
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(1.205, 0.324, -0.205)
R  ->  T0 : rotation\n = Vector3(0.0663225, -1.73486, -0.00523599)


....
---

==== zoom_chapter_4

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(0.89739, 0.524141, 0.372991)
R  ->  T0 : rotation\n = Vector3(-0.197222, -1.309, 0.0383972)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = 0.1
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(1.414, 0.365, 0.54)
R  ->  T0 : rotation\n = Vector3(0.111701, -0.0453786, -0.0174533)


....
---

==== zoom_chapter_5

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.505, 0.533, 0.685)
R  ->  T0 : rotation\n = Vector3(-0.139626, -0.523599, 0.0733038)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = 0.2
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(1.433, 0.392, 0.255)
R  ->  T0 : rotation\n = Vector3(0.20944, -1.72089, -0.00698132)


....
---

==== zoom_chapter_6

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.6676, 0.843824, 0.187534)
R  ->  T0 : rotation\n = Vector3(-0.249582, 1.46259, 0.0139626)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = 0.6
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(2.075, 0.676, -0.28)
R  ->  T0 : rotation\n = Vector3(-0.185005, 3.27947, -0.0558505)


....
---

==== zoom_chapter_7

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(2.238, 0.179, -1.871)
R  ->  T0 : rotation\n = Vector3(0.307178, 3.01942, 0.00174533)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 0.0
R  ->  T4 : environment\n = 0.75
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(2.238, 0.291302, -1.73145)
R  ->  T0 : rotation\n = Vector3(0.241115, 3.02168, 0.0100912)


....
---

==== zoom_chapter_8

[plantuml]
....
control "Root" as R
participant "$Path3D\n/PathFollow3D\n/Camera3D" as T0
participant "$Path3D\n/PathFollow3D" as T2
participant "$Mountain\n/MountainCoreSurface" as T3
participant "$WorldEnvironment" as T4
participant "$Mist" as T5



== Time: 0.0 ==
R  ->  T0 : position\n = Vector3(1.957, 0.82, -0.531)
R  ->  T0 : rotation\n = Vector3(-0.406981, 3.12041, 0.0460821)
R  ->  T2 : progress_ratio\n = 0.0
R  ->  T3 : blend_shapes/Hide\n = 1.0
R  ->  T4 : environment\n = 1.0
R  ->o  T5 : visible\n = false
== Time: 0.5 ==
R  ->  T0 : position\n = Vector3(1.957, 0.812906, -0.450644)
R  ->  T0 : rotation\n = Vector3(-0.412425, 3.12036, 0.0462081)


....
---



=== Properties
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*script* |`ExtResource("1_phfn5")`
|*CameraNode* |`NodePath("Path3D/PathFollow3D/Camera3D")`
|===
.#$SpotLights/Chapter0# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(0.00701346, -0.958252, 0.285839, 0.0572578, 0.285762, 0.956589, -0.998335, 0.00965756, 0.0568716, -0.28715, 0.0306233, -0.840506)`
|*light_color* |`Color(0.914361, 0.553244, 0.844536, 1)`
|*spot_range* |`0.1`
|===
.#$SpotLights/Chapter1# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(0.0801051, -0.989197, -0.122772, 0.00810283, -0.122517, 0.992433, -0.996754, -0.0804937, -0.00179896, -0.453171, 0.118333, -0.297492)`
|*light_color* |`Color(0.295293, 0.426444, 0.435629, 1)`
|*light_energy* |`0.5`
|*light_specular* |`5.0`
|*light_bake_mode* |`1`
|*spot_range* |`0.091`
|*spot_angle* |`67.956`
|===
.#$SpotLights/Chapter2_1# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(0.872807, -0.440018, -0.211168, 0.178005, -0.115872, 0.977184, -0.454447, -0.890482, -0.0228083, -0.469845, 0.233757, 0.0936139)`
|*light_color* |`Color(0.369019, 0.215366, 0.133746, 1)`
|*light_energy* |`0.5`
|*light_specular* |`5.0`
|*spot_range* |`0.1`
|===
.#$SpotLights/Chapter2_2# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(0.882029, -0.453417, 0.128208, -0.124509, 0.0381462, 0.991485, -0.454447, -0.890482, -0.0228083, -0.469845, 0.274668, 0.0936139)`
|*light_color* |`Color(0.369019, 0.215366, 0.133746, 1)`
|*light_energy* |`0.5`
|*light_specular* |`5.0`
|*spot_range* |`0.1`
|===
.#$SpotLights/Chapter3# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(-0.92179, -0.371002, 0.112523, 0.223451, -0.271233, 0.936217, -0.316818, 0.888139, 0.332921, -0.110666, 0.373874, 0.347782)`
|*light_color* |`Color(0.816799, 0.597135, 0.462843, 1)`
|*light_energy* |`0.1`
|*spot_range* |`0.1`
|===
.#$SpotLights/Chapter8# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(-0.250815, 0.0633653, 0.965959, 0.00601347, 0.997938, -0.0639017, -0.968017, -0.0102187, -0.250678, -0.0657851, 0.607352, -0.217476)`
|*light_color* |`Color(0.914361, 0.553244, 0.844536, 1)`
|*spot_range* |`0.1`
|===
.#$DirectionalLight3D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(1, 0, 0, 0, 0.318943, 0.947774, 0, -0.947774, 0.318943, 0, 0, 0)`
|*light_color* |`Color(0.427192, 0.516328, 0.867139, 1)`
|*sky_mode* |`1`
|===
.#$WorldEnvironment# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*environment* |`SubResource("Environment_b1s5s")`
|*compositor* |`SubResource("Compositor_vow5d")`
|===
.#$Path3D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0614908, 0, -0.286387)`
|*curve* |`SubResource("Curve3D_bt8sv")`
|===
.#$Path3D/PathFollow3D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*transform* |`Transform3D(7.5485e-08, 0.000999828, 0.999827, -5.81978e-11, 0.999828, -0.000999827, -0.99983, 1.72872e-11, 7.54849e-08, -3.77489e-10, 2.91038e-13, 2.005)`
|*h_offset* |`-0.005`
|===
.#$Path3D/PathFollow3D/Camera3D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*transform* |`Transform3D(-0.519203, 0.0753502, -0.851524, 0.000438006, 0.996302, 0.0878944, 0.85485, 0.0452544, -0.517228, 0.52904, 0.621466, -0.783036)`
|*fov* |`40.0`
|*near* |`0.057`
|===
.#$Blinder# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*modulate* |`Color(0, 0, 0, 0.784314)`
|*anchors_preset* |`15`
|*anchor_right* |`1.0`
|*anchor_bottom* |`1.0`
|*grow_horizontal* |`2`
|*grow_vertical* |`2`
|===
.#$Mist# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*modulate* |`Color(1, 1, 1, 1)`
|*position* |`Vector2(0, -1)`
|===
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* |`true`
|*libraries* |`{
&"": SubResource("AnimationLibrary_as40k")
}`
|*autoplay* |`opening`
|===


=== link:/scripts/src/world/world.gd[world.gd]

```gdscript
extends Node3D

@export_node_path("Camera3D") var CameraNode : NodePath


func back_to_circular_move() -> void:
	%AnimationPlayer.play('back_to_circular_move')


func focus_chapter(idx: int) -> void:
	var anim_name = "focus_chapter_%s" % idx
	var animation = %AnimationPlayer.get_animation(anim_name)
	initialize_animation_camera_key(animation, 'position')
	initialize_animation_camera_key(animation, 'rotation')
	%AnimationPlayer.play(anim_name)


func zoom_chapter(idx: int) -> void:
	var anim_name = "zoom_chapter_%s" % idx
	%AnimationPlayer.play(anim_name)


func initialize_animation_camera_key(animation: Animation, key: String) -> void:
	var track_idx = animation.find_track(
		'%s:%s' % [CameraNode, key], Animation.TrackType.TYPE_VALUE)
	var value = %Camera3D.get(key)
	var goal  = animation.track_get_key_value(track_idx, 1)
	if key == 'rotation': value = smooth_rotation(value, goal)
	animation.track_set_key_value(track_idx, 0, value)


func smooth_rotation(rot: Vector3, goal: Vector3) -> Vector3:
	return Vector3(rot.x, acute_angle(rot.y, goal.y), rot.z)


func acute_angle(val: float, goal: float) -> float:
	var delta = val - goal
	if 	 delta >  PI: return val - 2*PI
	elif delta < -PI: return val + 2*PI
	else: return val


func _on_animation_player_animation_finished(anim_name: StringName) -> void:
	match anim_name:
		'opening': %AnimationPlayer.play('circular_move')
		'back_to_circular_move': %AnimationPlayer.play('circular_move')
		_: pass

```


