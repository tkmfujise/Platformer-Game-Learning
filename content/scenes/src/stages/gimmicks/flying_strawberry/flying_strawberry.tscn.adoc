---
title: src/stages/gimmicks/flying_strawberry/flying_strawberry.tscn
---
:toc:

== src / stages / gimmicks / flying_strawberry / flying_strawberry.tscn

=== Diagram
[plantuml]
....
class R as "FlyingStrawberry" <<(A,lightskyblue) Area2D>> {
  - OFFSET
  * player_path
  * player
  * touched
  * obtained
---
  + _ready()
  + reset()
  + _physics_process()
  + fly_away()
  + ascend()
  + play()
  + _on_hit_area_entered()
  + _on_area_entered()
}
class N1 as "ResetOnPlayerRestart" <<(N,darkgray) Node>> {
  * duration
---
  + _ready()
  + reset()
}
class N2 as "Pivot" <<(N,lightskyblue) Node2D>> {
}
class N3 as "Sprite2D" <<(S,lightskyblue) Sprite2D>> {
}
class N4 as "HitArea" <<(A,lightskyblue) Area2D>> {
}
class N5 as "CollisionShape2D" <<(C,lightskyblue) CollisionShape2D>> {
}
class N6 as "VisibleOnScreenNotifier2D" <<(V,lightskyblue) VisibleOnScreenNotifier2D>> {
}
class N7 as "AnimationPlayer" <<(A,yellow) AnimationPlayer>> {
}
R --o N1
R --o N2
R --o N6
R --o N7
N2 --o N3
N2 --o N4
N4 --o N5
!define _(a,b) a <-[#blue,thickness=2]- b
left to right direction
_(R::_on_area_entered, R::area_entered)
_(R::_on_hit_area_entered, N4::area_entered)
....


[.scene-assets]
=== Assets
[.asset-image]
[link=/assets/assets/images/stages/gimmicks/FlyingStrawberry.png]
image::/assets/raw/assets/images/stages/gimmicks/FlyingStrawberry.png[200, 100] 



=== Overridden virtual functions
==== _ready
```gdscript
func _ready() -> void:
	if player_path:
		player = get_node(player_path)
		player.dashed.connect(fly_away)
	if obtained: hide()
```
.$ResetOnPlayerRestart
```gdscript
func _ready() -> void:
	if owner and owner.has_method(&'reset'):
		GameEvent.player_restarted.connect(reset)
```
==== _physics_process
```gdscript
func _physics_process(_delta: float) -> void:
	if touched and player:
		var target := player.global_position + OFFSET
		%Pivot.global_position = %Pivot.global_position.lerp(target, 0.1)
```


=== Instantiators
* link:/scenes/src/chapters/1/chapter1.tscn[res://src/chapters/1/chapter1.tscn]


=== Scene Tree
[.scene-tree]
* [.node-name.type-2d]#FlyingStrawberry# [.node-type.type-2d]#Area2D#
** [.node-name.type-plain]#ResetOnPlayerRestart# [.node-type.type-plain]#link:/scenes/src/mixins/reset_on_player_restart/reset_on_player_restart.tscn[res://src/mixins/reset_on_player_restart/reset_on_player_restart.tscn]#
** [.node-name.type-2d]#Pivot# [.node-type.type-2d]#Node2D#
*** [.node-name.type-2d]#Sprite2D# [.node-type.type-2d]#Sprite2D#
*** [.node-name.type-2d]#HitArea# [.node-type.type-2d]#Area2D#
**** [.node-name.type-2d]#CollisionShape2D# [.node-type.type-2d]#CollisionShape2D#
** [.node-name.type-2d]#VisibleOnScreenNotifier2D# [.node-type.type-2d]#VisibleOnScreenNotifier2D#
** [.node-name.type-other]#AnimationPlayer# [.node-type.type-other]#AnimationPlayer#


=== Signal Connections
[.signal-connection]
.$.:[#_area_entered_#]=>$.
```gdscript
func _on_area_entered(_area: Area2D) -> void:
	if not obtained and touched and player: ascend()
```
[.signal-connection]
.$Pivot/HitArea:[#_area_entered_#]=>$.
```gdscript
func _on_hit_area_entered(_area: Area2D) -> void:
	touched = true
```


=== Animations
==== Animation_rlj1e

[plantuml]
....
control "Root" as R
participant "$Pivot\n/Sprite2D" as T0 #87CEFA
participant "$Pivot" as T3 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : frame\n = 0
R  ->  T0 : position\n = Vector2(0, 0)
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->  T3 : position\n = Vector2(0, 0)


....
---

==== ascend

[plantuml]
....
control "Root" as R
participant "$Pivot\n/Sprite2D" as T0 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : frame\n = 0
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
== Time: 0.05 ==
R  ->o  T0 : frame\n = 6
== Time: 0.1 ==
R  ->o  T0 : frame\n = 7
== Time: 0.15 ==
R  ->o  T0 : frame\n = 8
== Time: 0.2 ==
R  ->o  T0 : frame\n = 9
== Time: 0.25 ==
R  ->o  T0 : frame\n = 10
== Time: 0.3 ==
R  ->o  T0 : frame\n = 11
== Time: 0.35 ==
R  ->o  T0 : frame\n = 12
== Time: 0.4 ==
R  ->o  T0 : frame\n = 13
== Time: 0.45000002 ==
R  ->o  T0 : frame\n = 14
== Time: 0.5 ==
R  ->o  T0 : frame\n = 15
== Time: 0.55 ==
R  ->o  T0 : frame\n = 16
== Time: 0.6 ==
R  ->o  T0 : frame\n = 17
R  ->  T0 : position\n = Vector2(0, 0)
== Time: 0.65 ==
R  ->o  T0 : frame\n = 18
== Time: 0.7 ==
R  ->o  T0 : frame\n = 19
== Time: 0.8 ==
R  ->o  T0 : frame\n = 20
== Time: 0.9 ==
R  ->o  T0 : frame\n = 21
== Time: 1.0 ==
R  ->o  T0 : frame\n = 22
== Time: 1.1 ==
R  ->o  T0 : frame\n = 23
== Time: 1.3 ==
R  ->  T0 : position\n = Vector2(0, -5)
== Time: 1.7 ==
R  ->o  T0 : frame\n = 16
== Time: 1.8 ==
R  ->o  T0 : frame\n = 14
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
== Time: 1.9 ==
R  ->o  T0 : frame\n = 15
== Time: 2.0 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)


....
---

==== fly_away

[plantuml]
....
control "Root" as R
participant "$Pivot\n/Sprite2D" as T0 #87CEFA
participant "$Pivot" as T2 #87CEFA



== Time: 0.0 ==
R  ->o  T0 : frame\n = 0
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
R  ->  T2 : position\n = Vector2(0, 0)
== Time: 0.1667 ==
R  ->o  T0 : frame\n = 1
== Time: 0.3334 ==
R  ->o  T0 : frame\n = 2
== Time: 0.5001 ==
R  ->o  T0 : frame\n = 3
== Time: 0.6668 ==
R  ->o  T0 : frame\n = 4
== Time: 0.8335 ==
R  ->o  T0 : frame\n = 5
== Time: 1.0 ==
R  ->  T2 : position\n = Vector2(0, -300)
== Time: 1.1666666 ==
R  ->  T0 : modulate\n = Color(1, 1, 1, 0)
== Time: 2.0 ==
R  ->  T2 : position\n = Vector2(0, 0)


....
---

==== idle (autoplay)

[plantuml]
....
control "Root" as R
participant "$Pivot\n/Sprite2D" as T0 #87CEFA


loop
== Time: 0.0 ==
R  ->o  T0 : frame\n = 0
R  ->  T0 : modulate\n = Color(1, 1, 1, 1)
== Time: 0.1667 ==
R  ->o  T0 : frame\n = 1
== Time: 0.3334 ==
R  ->o  T0 : frame\n = 2
== Time: 0.5001 ==
R  ->o  T0 : frame\n = 3
== Time: 0.6668 ==
R  ->o  T0 : frame\n = 4
== Time: 0.8335 ==
R  ->o  T0 : frame\n = 5

end
....
---



=== Properties
[.node-property.node-2d]
.#Root# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*scale* a|`Vector2(4.6, 4.6)`
|*collision_layer* a|`0`
|*collision_mask* a|`2`
|*script* a|link:/scripts/src/stages/gimmicks/flying_strawberry/flying_strawberry.gd[res://src/stages/gimmicks/flying_strawberry/flying_strawberry.gd]
|===
[.node-property.node-2d]
.#$Pivot# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|===
[.node-property.node-2d]
.#$Pivot/Sprite2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*texture* a|[link=/assets/assets/images/stages/gimmicks/FlyingStrawberry.png]
[.asset-image]
.res://assets/images/stages/gimmicks/FlyingStrawberry.png
image::/assets/raw/assets/images/stages/gimmicks/FlyingStrawberry.png[]

|*hframes* a|`24`
|===
[.node-property.node-2d]
.#$Pivot/HitArea# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*collision_layer* a|`0`
|*collision_mask* a|`2`
|===
[.node-property.node-2d]
.#$Pivot/HitArea/CollisionShape2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*position* a|`Vector2(0.43478262, -0.43478262)`
|*shape* a|`SubResource("CircleShape2D_6ayuk")`
|===
[.node-property.node-2d]
.#$VisibleOnScreenNotifier2D# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|===
[.node-property.node-other]
.#$AnimationPlayer# properties
[cols="1,3" options="header"]
|===
|Name |Value
|*unique_name_in_owner* a|`true`
|*libraries* a|`{
&"": SubResource("AnimationLibrary_nrel5")
}`
|*autoplay* a|`idle`
|===


=== link:/scripts/src/stages/gimmicks/flying_strawberry/flying_strawberry.gd[flying_strawberry.gd]

```gdscript
extends Area2D

@export_node_path(&'Player') var player_path
@onready var player : Player
@onready var touched : bool = false
@export var obtained : bool = false
const OFFSET := Vector2(0, -200)


func _ready() -> void:
	if player_path:
		player = get_node(player_path)
		player.dashed.connect(fly_away)
	if obtained: hide()


func reset() -> void:
	%Pivot.position = Vector2(0, 0)
	touched = false
	if obtained: hide()
	play(&'RESET')
	play.call_deferred(&'idle')


func _physics_process(_delta: float) -> void:
	if touched and player:
		var target := player.global_position + OFFSET
		%Pivot.global_position = %Pivot.global_position.lerp(target, 0.1)


func fly_away() -> void:
	if %VisibleOnScreenNotifier2D.is_on_screen():
		if not touched: play(&'fly_away')


func ascend() -> void:
	play(&'ascend')
	obtained = true


func play(key: StringName) -> void:
	%AnimationPlayer.play(key)


func _on_hit_area_entered(_area: Area2D) -> void:
	touched = true


func _on_area_entered(_area: Area2D) -> void:
	if not obtained and touched and player: ascend()

```


